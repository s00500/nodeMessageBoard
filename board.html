<!DOCTYPE html>
 <meta charset="UTF-8">
 <html>
  <head>
<title>SMS Board</title>
  <!--<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
  <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
	<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
	<script src="/socket.io/socket.io.js">
  </script>

<script>
  const toDisplay = 4; //define the number of messages to show
  var iosocket;
  var currentMessageCount = 0;



	function initSocketIO()
	{
		iosocket = io.connect();
		iosocket.on('onconnection', function() {
		initButton();

		iosocket.on('debugMessage', function(message) {
			alert(message);
		});

     iosocket.on('newMessage', function(time,number,message) {
       var censoredNumber = number.substring(0,3) + "********" +number.substring(number.length - 3, number.length);

       var messages = document.getElementById('messagesBody');
       var newDiv = document.createElement('div');
       var newH1 = document.createElement('h1');
       var newP = document.createElement('p');
       newH1.innerHTML = message;
       newP.innerHTML = "by "+censoredNumber+" at "+time;
       newDiv.style="background:#428bca !important; padding:10px 0;";
       newDiv.className="jumbotron";
       newDiv.appendChild(newH1);
       newDiv.appendChild(newP);
       messages.appendChild(newDiv);


       currentMessageCount++;
       if(currentMessageCount > toDisplay)
       {
         //Remove the top row
         $('#messagesBody').find('div').first().remove();
         //messages.removeChild(messages.firstChild);
         //mainTable.deleteRow(1);
        currentMessageCount--;
       }
	    });
    });
	}


	function initButton()
	{
	   $("#check").button();
	}

	window.onload = function() {
	     initSocketIO();
       iosocket.emit('getLastMessages',toDisplay);
      };


  $(document).ready(function() {
      $('#check').click(function() {
	    iosocket.emit('sendAT',toggleVal);
	    });
       //$('#debugOut').html(String.fromCharCode(parseInt(s, 16),parseInt("DE03",16)));
	});


</script>

  </head>
  <body>
   <div style="text-align:center;" >
	<!--<h1 style="color:#000066;">SMS Message Board</h1>-->

  <h3>Send an SMS with a message to <span style="color:#3399ff;">+43 681 2033 4015</span></h3>
  <br>
  <div id="messagesBody">

  </div>
  <h3>Send an SMS with a message to <span style="color:#3399ff;">+43 681 2033 4015</span></h3>

  <br>
  <br>
	<div style="display:none;" id="btnHolder">
    <h2>Debug functions</h2>
	  <input type="checkbox" id="check" value="toggle"/><label for="check">Send AT</label>
	</div>

   <div id="debugOut"> </div>
  </body>
</html>
